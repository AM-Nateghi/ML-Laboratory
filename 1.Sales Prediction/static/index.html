<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÙØ±Ù… Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙØ±ÙˆØ´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body
    class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen flex items-center justify-center p-4"
  >
    <div class="bg-white shadow-2xl rounded-xl p-8 w-full max-w-3xl">
      <h1 class="text-2xl font-bold text-center mb-6 text-indigo-700">
        Ù¾Ù†Ù„ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙØ±ÙˆØ´
      </h1>

      <form id="predictForm" class="space-y-4">
        <!-- Customers -->
        <div>
          <label class="block mb-1 font-medium">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù†</label>
          <input
            type="number"
            name="Customers"
            class="w-full border rounded-lg p-2 focus:ring focus:ring-indigo-200"
          />
          <span class="text-red-500 text-sm hidden" id="err_Customers"></span>
        </div>

        <!-- Store Type -->
        <div>
          <label class="block mb-1">Ù†ÙˆØ¹ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</label>
          <select name="StoreType" class="w-full border rounded-lg p-2">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            <option value="0">Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª Ú©ÙˆÚ†Ú© ğŸ›’</option>
            <option value="1">Ù‡Ø§ÛŒÙ¾Ø±Ù…Ø§Ø±Ú©Øª ğŸ¢</option>
            <option value="2">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ØªØ®ØµØµÛŒ ğŸ¯</option>
            <option value="3">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø²Ù†Ø¬ÛŒØ±Ù‡â€ŒØ§ÛŒ Ø¨Ø²Ø±Ú¯ ğŸ¬</option>
          </select>
          <span class="text-red-500 text-sm hidden" id="err_StoreType"></span>
        </div>

        <!-- Assortment -->
        <div>
          <label class="block mb-1">ØªÙ†ÙˆØ¹ Ú©Ø§Ù„Ø§</label>
          <select name="Assortment" class="w-full border rounded-lg p-2">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            <option value="0">Ú©Ù…</option>
            <option value="1">Ù…ØªÙˆØ³Ø·</option>
            <option value="2">Ø²ÛŒØ§Ø¯</option>
          </select>
          <span class="text-red-500 text-sm hidden" id="err_Assortment"></span>
        </div>

        <!-- State Holiday -->
        <div>
          <label class="block mb-1">ØªØ¹Ø·ÛŒÙ„Ø§Øª Ø±Ø³Ù…ÛŒ</label>
          <select name="StateHoliday" class="w-full border rounded-lg p-2">
            <option value="false">Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ</option>
            <option value="true">ØªØ¹Ø·ÛŒÙ„ Ø±Ø³Ù…ÛŒ ğŸ–ï¸</option>
          </select>
        </div>

        <!-- School Holiday -->
        <div>
          <label class="block mb-1">ØªØ¹Ø·ÛŒÙ„ÛŒ Ù…Ø¯Ø§Ø±Ø³</label>
          <select name="SchoolHoliday" class="w-full border rounded-lg p-2">
            <option value="false">Ù…Ø¯Ø§Ø±Ø³ Ø¨Ø§Ø²</option>
            <option value="true">Ù…Ø¯Ø§Ø±Ø³ ØªØ¹Ø·ÛŒÙ„ ğŸ«ğŸšª</option>
          </select>
        </div>

        <!-- Promo -->
        <div>
          <label class="block mb-1">Ù¾Ø±ÙˆÙ…ÙˆØ´Ù† ÙØ¹Ø§Ù„</label>
          <select name="Promo" class="w-full border rounded-lg p-2">
            <option value="false">Ø¨Ø¯ÙˆÙ† ØªØ®ÙÛŒÙ</option>
            <option value="true">Ø¯Ø§Ø±Ø§ÛŒ ØªØ®ÙÛŒÙ ğŸ‰</option>
          </select>
        </div>

        <!-- Has Competition -->
        <div>
          <label class="flex items-center">
            <input
              type="checkbox"
              id="HasCompetition"
              name="HasCompetition"
              class="w-4 h-4"
            />
            <span class="ml-2">Has Competition</span>
          </label>
        </div>
        <div id="competitionFields" class="hidden grid grid-cols-3 gap-4">
          <input
            type="number"
            step="0.1"
            name="CompetitionDistance"
            placeholder="ÙØ§ØµÙ„Ù‡ Ø±Ù‚Ø¨Ø§"
            class="border rounded-lg p-2"
          />
          <input
            type="number"
            name="CompetitionOpenSinceMonth"
            placeholder="Ù…Ø§Ù‡ Ø´Ø±ÙˆØ¹"
            class="border rounded-lg p-2"
          />
          <input
            type="number"
            name="CompetitionOpenSinceYear"
            placeholder="Ø³Ø§Ù„ Ø´Ø±ÙˆØ¹"
            class="border rounded-lg p-2"
          />
        </div>
        <span class="text-red-500 text-sm hidden" id="err_Competition"></span>

        <!-- Promo2 -->
        <div>
          <label class="flex items-center">
            <input type="checkbox" id="Promo2" name="Promo2" class="w-4 h-4" />
            <span class="ml-2">Promo2</span>
          </label>
        </div>
        <div id="promo2Fields" class="hidden grid grid-cols-3 gap-4">
          <input
            type="number"
            name="Promo2SinceWeek"
            placeholder="Ø§Ø² Ù‡ÙØªÙ‡"
            class="border rounded-lg p-2"
          />
          <input
            type="number"
            name="Promo2SinceYear"
            placeholder="Ø§Ø² Ø³Ø§Ù„"
            class="border rounded-lg p-2"
          />
          <input
            type="number"
            name="PromoInterval"
            placeholder="Interval"
            class="border rounded-lg p-2"
          />
        </div>
        <span class="text-red-500 text-sm hidden" id="err_Promo2"></span>

        <!-- Date -->
        <div class="grid grid-cols-2 gap-4">
          <input
            type="number"
            name="month"
            placeholder="Ù…Ø§Ù‡"
            class="border rounded-lg p-2"
          />
          <input
            type="number"
            name="year"
            placeholder="Ø³Ø§Ù„"
            class="border rounded-lg p-2"
          />
        </div>
        <span class="text-red-500 text-sm hidden" id="err_Date"></span>

        <!-- Submit -->
        <button
          type="submit"
          class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition"
        >
          Ø§Ø±Ø³Ø§Ù„
        </button>
      </form>

      <!-- Result -->
      <div
        id="result"
        class="mt-6 text-center text-lg font-semibold text-gray-700"
      ></div>
    </div>

    <script>
      $(document).ready(function () {
        // Toggle fields
        $("#HasCompetition").change(function () {
          $("#competitionFields").toggle(this.checked);
        });
        $("#Promo2").change(function () {
          $("#promo2Fields").toggle(this.checked);
        });

        // Custom validation
        $("#predictForm").submit(function (e) {
          e.preventDefault();
          let valid = true;

          // Reset errors
          $("span[id^='err_']").addClass("hidden").text("");

          let customers = $("input[name='Customers']").val();
          if (customers < 20 || customers > 6000 || customers === "") {
            $("#err_Customers")
              .removeClass("hidden")
              .text("ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 20 ØªØ§ 6000 Ø¨Ø§Ø´Ø¯");
            valid = false;
          }

          let storeType = $("input[name='StoreType']").val();
          if (storeType < 0 || storeType > 3 || storeType === "") {
            $("#err_StoreType")
              .removeClass("hidden")
              .text("Store Type Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 0 ØªØ§ 3 Ø¨Ø§Ø´Ø¯");
            valid = false;
          }

          let assortment = $("input[name='Assortment']").val();
          if (assortment < 0 || assortment > 2 || assortment === "") {
            $("#err_Assortment")
              .removeClass("hidden")
              .text("Assortment Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 0 ØªØ§ 2 Ø¨Ø§Ø´Ø¯");
            valid = false;
          }

          if ($("#HasCompetition").is(":checked")) {
            let compFields = [
              "CompetitionDistance",
              "CompetitionOpenSinceMonth",
              "CompetitionOpenSinceYear",
            ];
            for (let f of compFields) {
              if ($(`input[name='${f}']`).val() === "") {
                $("#err_Competition")
                  .removeClass("hidden")
                  .text("Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø±Ù‚Ø¨Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯");
                valid = false;
                break;
              }
            }
          }

          if ($("#Promo2").is(":checked")) {
            let promo2Fields = [
              "Promo2SinceWeek",
              "Promo2SinceYear",
              "PromoInterval",
            ];
            for (let f of promo2Fields) {
              if ($(`input[name='${f}']`).val() === "") {
                $("#err_Promo2")
                  .removeClass("hidden")
                  .text("Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Promo2 Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯");
                valid = false;
                break;
              }
            }
          }

          let month = $("input[name='month']").val();
          let year = $("input[name='year']").val();
          if (month < 1 || month > 12 || month === "" || year === "") {
            $("#err_Date")
              .removeClass("hidden")
              .text("Ù…Ø§Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 1 ØªØ§ 12 Ø¨Ø§Ø´Ø¯ Ùˆ Ø³Ø§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
            valid = false;
          }

          if (!valid) return;

          // Prepare data
          let formData = $("#predictForm").serializeArray();
          let data = {};
          formData.forEach((item) => {
            data[item.name] =
              item.value === "on"
                ? true
                : isNaN(item.value) || item.value === ""
                ? item.value
                : Number(item.value);
          });

          // Send request
          $.ajax({
            url: "/predict",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (res) {
              $("#result").text(JSON.stringify(res));
            },
            error: function () {
              $("#result").text("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡");
            },
          });
        });
      });
    </script>
  </body>
</html>
